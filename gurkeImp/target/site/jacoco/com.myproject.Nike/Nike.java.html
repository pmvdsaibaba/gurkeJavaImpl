<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Nike.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gurkeImp</a> &gt; <a href="index.source.html" class="el_package">com.myproject.Nike</a> &gt; <span class="el_source">Nike.java</span></div><h1>Nike.java</h1><pre class="source lang-java linenums">package com.myproject.Nike;

import java.security.SecureRandom;
import java.security.Security;

import org.bouncycastle.jce.provider.BouncyCastleProvider;
import java.security.*;

import javax.crypto.Cipher;

import java.util.Base64;

import java.security.KeyPairGenerator;

import java.security.NoSuchAlgorithmException;
import java.security.NoSuchProviderException;

import org.bouncycastle.crypto.generators.X25519KeyPairGenerator;
import org.bouncycastle.crypto.params.X25519PrivateKeyParameters;
import org.bouncycastle.crypto.params.X25519PublicKeyParameters;
import org.bouncycastle.crypto.params.X25519KeyGenerationParameters;
import org.bouncycastle.crypto.prng.FixedSecureRandom;

import org.bouncycastle.crypto.AsymmetricCipherKeyPair;

import org.bouncycastle.jcajce.spec.XDHParameterSpec;


import org.bouncycastle.crypto.agreement.X25519Agreement;
// import org.bouncycastle.crypto.params.CipherParameters;

<span class="nc" id="L32">public class Nike {</span>

    // Add Bouncy Castle as a Security Provider
    static {
<span class="fc" id="L36">        Security.addProvider(new BouncyCastleProvider());</span>
<span class="fc" id="L37">    }</span>


    // This method simulates the generation of encapsulation and decapsulation keys
    public static KeyPair gen() throws NoSuchAlgorithmException, NoSuchProviderException {

        // Security.addProvider(new BouncyCastleProvider());
        

// Version 1
// this version is generating ek and dk of different size. This is because of some encoding. 
        // // X25519 KeyPair Generator
        // KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(&quot;X25519&quot;, &quot;BC&quot;);

        //  // No need to initialize with XDHParameterSpec, just call generateKeyPair()
        // keyPairGenerator.init(new XDHParameterSpec(XDHParameterSpec.X25519));
        // // keyPairGenerator.initialize(new XDHParameterSpec(XDHParameterSpec.X25519));

        // // Generate the key pair
		// java.security.KeyPair keyPair = keyPairGenerator.generateKeyPair();


        // byte[] publicKeyBytes = keyPair.getPublic().getEncoded();
        // byte[] privateKeyBytes = keyPair.getPrivate().getEncoded();
        
// Version 2
// This is (Low-Level Bouncy Castle API) so that there is no encoding as previous version.

        // Create a SecureRandom instance
<span class="fc" id="L66">        SecureRandom random = new SecureRandom();</span>

        // Initialize the X25519 key pair generator
<span class="fc" id="L69">        X25519KeyPairGenerator keyPairGenerator = new X25519KeyPairGenerator();</span>

        // Initialize with X25519 parameters (SecureRandom instance)
<span class="fc" id="L72">        X25519KeyGenerationParameters params = new X25519KeyGenerationParameters(random);</span>
<span class="fc" id="L73">        keyPairGenerator.init(params);</span>

        // Generate the key pair
<span class="fc" id="L76">        AsymmetricCipherKeyPair keyPair = keyPairGenerator.generateKeyPair();</span>
        // Extract the public and private keys from the key pair
<span class="fc" id="L78">        X25519PublicKeyParameters publicKeyParameters = (X25519PublicKeyParameters) keyPair.getPublic();</span>
<span class="fc" id="L79">        X25519PrivateKeyParameters privateKeyParameters = (X25519PrivateKeyParameters) keyPair.getPrivate();</span>

        // Convert the keys to byte arrays (encoded format)
<span class="fc" id="L82">        byte[] publicKeyBytes = publicKeyParameters.getEncoded();</span>
<span class="fc" id="L83">        byte[] privateKeyBytes = privateKeyParameters.getEncoded();</span>
<span class="fc" id="L84">        return new KeyPair(publicKeyBytes, privateKeyBytes);</span>
    }
    
    // KeyPair class to hold the encapsulation key and decapsulation key
    public static class KeyPair {
        private byte[] publicKey; // Store the public key as a byte array
        private byte[] privateKey; // Store the private key as a byte array

        // Constructor to initialize KeyPairHolder with public and private keys as byte arrays
<span class="fc" id="L93">        public KeyPair(byte[] ek, byte[] dk) {</span>
<span class="fc" id="L94">            this.publicKey = ek;</span>
<span class="fc" id="L95">            this.privateKey = dk;</span>
<span class="fc" id="L96">        }</span>

            public byte[] getEk() {
<span class="fc" id="L99">                return publicKey;</span>
            }
            
            public byte[] getDk() {
<span class="fc" id="L103">                return privateKey;</span>
            }
    }

    // N.gen(s) : Generate the public and private keys with a given seed (SK -&gt; PK)
    public static KeyPair gen(byte[] seed) throws NoSuchAlgorithmException, NoSuchProviderException {
        // Add the BouncyCastle provider
        // Security.addProvider(new BouncyCastleProvider());

        // Initialize the SecureRandom instance with the provided seed
        // SecureRandom random = new SecureRandom(seed);

<span class="fc" id="L115">        FixedSecureRandom random = new FixedSecureRandom(seed); // Pass the seed directly</span>

        // Initialize the X25519 key pair generator
<span class="fc" id="L118">        X25519KeyPairGenerator keyPairGenerator = new X25519KeyPairGenerator();</span>

        // Example of testing without SecureRandom
        // byte[] fixedRandomBytes = new byte[32]; // Same 32-byte array every time
        // for (int i = 0; i &lt; fixedRandomBytes.length; i++) {
        //     fixedRandomBytes[i] = (byte) 0xEF;  // Fill with 0xEF (EFEFEFE pattern)
        // }
        // X25519KeyGenerationParameters params = new X25519KeyGenerationParameters(new SecureRandom(fixedRandomBytes));


        // Initialize with X25519 parameters (using the seeded SecureRandom instance)
<span class="fc" id="L129">        X25519KeyGenerationParameters params = new X25519KeyGenerationParameters(random);</span>
<span class="fc" id="L130">        keyPairGenerator.init(params);</span>

        // Generate the key pair
<span class="fc" id="L133">        AsymmetricCipherKeyPair keyPair = keyPairGenerator.generateKeyPair();</span>

        // Extract the public and private keys from the key pair
<span class="fc" id="L136">        X25519PublicKeyParameters publicKeyParameters = (X25519PublicKeyParameters) keyPair.getPublic();</span>
<span class="fc" id="L137">        X25519PrivateKeyParameters privateKeyParameters = (X25519PrivateKeyParameters) keyPair.getPrivate();</span>

        // Convert the keys to byte arrays (encoded format)
<span class="fc" id="L140">        byte[] publicKeyBytes = publicKeyParameters.getEncoded();</span>
<span class="fc" id="L141">        byte[] privateKeyBytes = privateKeyParameters.getEncoded();</span>

        // Return the key pair (with public and private keys as byte arrays)
<span class="fc" id="L144">        return new KeyPair(publicKeyBytes, privateKeyBytes);</span>
    }

    // N.key : Compute the shared key using secret key and public key (SK, PK -&gt; K)
    public static byte[] key(byte[] secretKey, byte[] publicKey) throws Exception {
        // Convert byte arrays into X25519 Private and Public Key parameters
<span class="fc" id="L150">        X25519PrivateKeyParameters privateKeyParameters = new X25519PrivateKeyParameters(secretKey, 0);</span>
<span class="fc" id="L151">        X25519PublicKeyParameters publicKeyParameters = new X25519PublicKeyParameters(publicKey, 0);</span>

        // Initialize the X25519Agreement with the private key
<span class="fc" id="L154">        X25519Agreement agreement = new X25519Agreement();</span>
<span class="fc" id="L155">        agreement.init(privateKeyParameters);</span>

        // Prepare a buffer to hold the shared key
<span class="fc" id="L158">        byte[] sharedKey = new byte[agreement.getAgreementSize()];</span>

        // Calculate the shared agreement
<span class="fc" id="L161">        agreement.calculateAgreement(publicKeyParameters, sharedKey, 0);</span>

        // Return the shared key
<span class="fc" id="L164">        return sharedKey;</span>
    }

}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>